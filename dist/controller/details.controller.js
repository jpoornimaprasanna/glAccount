sap.ui.define(["GlAccountsWiki/GlAccountsWiki/controller/BaseController","GlAccountsWiki/GlAccountsWiki/util/powerBiControls","sap/ui/model/json/JSONModel","sap/m/MessageToast","GlAccountsWiki/GlAccountsWiki/util/formatter","sap/ui/export/Spreadsheet","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/BusyDialog"],function(e,t,o,n,l,r,i,a){"use strict";var s;return e.extend("GlAccountsWiki.GlAccountsWiki.controller.details",{pwbi:t,formatter:l,onInit:function(){var e=new o;this.getOwnerComponent().setModel(e,"glAccountModel");this._setData();this._setPaginationHeight();this.getOwnerComponent().getModel("glAccountModel").setProperty("/balanceType","All");this.getOwnerComponent().getModel("glAccountModel").setProperty("/accountGroup","All");this.getOwnerComponent().getModel("glAccountModel").setProperty("/statusActive","Active");this.getOwnerComponent().getModel("glAccountModel").setProperty("/downRecords",[]);this.getOwnerComponent().getModel("glAccountModel").setProperty("/indicesValues",[]);this.tableData()},_setPaginationHeight:function(){var e=sap.ui.Device.resize.height;var t=e*.5;t=t+"vh";var o=e*10;o=o+"vh";this.getOwnerComponent().getModel("dashBoardModel").setProperty("/paginationHeight",t);this.getOwnerComponent().getModel("dashBoardModel").setProperty("/paginationHeight1",o)},_setData:function(){this.getOwnerComponent().getModel("glAccountModel").setProperty("/statusActive","Active");this.getOwnerComponent().getModel("glAccountModel").setProperty("/pageCount","1");this.getOwnerComponent().getModel("glAccountModel").setProperty("/paginationVisibility",true)},paginationVisible:function(){var e=this;var t=e.getOwnerComponent().getModel("glAccountModel").getData().totalRecords;var o=Number(e.getOwnerComponent().getModel("glAccountModel").getData().pageCount);if(o===1){this.getOwnerComponent().getModel("glAccountModel").setProperty("/previousButtonVisible",false)}},onAfterRendering:function(){this.tableData();this.paginationVisible();this.comboData();this.getOwnerComponent().getModel("glAccountModel").setProperty("/filtersApplied",0);sap.ui.Device.resize.attachHandler(function(){this._setPaginationHeight()}.bind(this));var e=this.getView().byId("balanceTypeId");var t=this.getView().byId("accountGroupId");var o=this.getView().byId("idStatus");e.addEventDelegate({onAfterRendering:function(){e.$().find("input").attr("readonly",true)}});t.addEventDelegate({onAfterRendering:function(){t.$().find("input").attr("readonly",true)}});o.addEventDelegate({onAfterRendering:function(){o.$().find("input").attr("readonly",true)}});this.onSearch()},doAjax:function(e,t,o,n,l){if(o){o=JSON.stringify(o)}var r=new sap.ui.model.json.JSONModel;this.getView().setModel(r,"tempJsonModel");r.loadData(e,o,true,t,false,false,{"Content-Type":"application/json;charset=utf-8"});r.attachRequestCompleted(function(e){n(e.getSource().getData())}.bind(n));r.attachRequestFailed(function(e){l(e)}.bind(l))},comboData:function(){var e=this;var t="/destination/Outsystem_Destinations/OutSystem-web/murphy/glAccountWiki/getDropDownValues";this.doAjax(t,"GET",null,function(t){e.getOwnerComponent().getModel("glAccountModel").setProperty("/combodata",t)}.bind(this),function(e){}.bind(this))},tableData:function(){var e=new sap.m.BusyDialog;var t=this;var o=this.getOwnerComponent().getModel("glAccountModel").getData();var n=o.statusActiveChange;var l=Number(o.pageCount);var r=l*100;var i=r-100;t.getOwnerComponent().getModel("glAccountModel").setProperty("/start",i);t.getOwnerComponent().getModel("glAccountModel").setProperty("/end",r);var a=o.isorbsValue;var s=o.AccClass;if(l===1){var c=1}else{var c=this.getOwnerComponent().getModel("glAccountModel").getData().pageCount;var c=0}var g="/destination/Outsystem_Destinations/OutSystem-web/murphy/glAccountWiki/fetchAllGLAccountDetails";var o=this.getOwnerComponent().getModel("glAccountModel").getData();if(o.uAccDesc){g+="&accountDesc="+o.uAccDesc}if(o.uAccName){g+="&accountName="+o.uAccName}if(o.uRollUp){g+="&accountRollup="+o.uRollUp}if(o.uGlAccount){g+="&glAccount="+o.uGlAccount}if(o.isorbsValue){g+="&glacntType="+o.isorbsValue}if(o.statusActiveChange){g+="&acntStatus="+o.statusActiveChange}if(o.AccClass){g+="&accountClsf="+o.AccClass}this.doAjax(g,"GET",null,function(o){e.close();debugger;t.getOwnerComponent().getModel("glAccountModel").setProperty("/data",o);var n=t.getOwnerComponent().getModel("glAccountModel").getData().data.glAccountsDtoList;var l=t.getOwnerComponent().getModel("glAccountModel").getData().data.totalRecords;t.getOwnerComponent().getModel("glAccountModel").setProperty("/totalRecords",l);t.getOwnerComponent().getModel("glAccountModel").setProperty("/pageSize",a);var r=t.getOwnerComponent().getModel("glAccountModel").getData().data.pageSize;var i=Number(t.getOwnerComponent().getModel("glAccountModel").getData().pageCount)*2;if(r+i<l){t.getOwnerComponent().getModel("glAccountModel").setProperty("/nextButtonVisible",true)}else if(r+i>l){t.getOwnerComponent().getModel("glAccountModel").setProperty("/previousButtonVisible",true);t.getOwnerComponent().getModel("glAccountModel").setProperty("/nextButtonVisible",false)}if(i-r>r){t.getOwnerComponent().getModel("glAccountModel").setProperty("/nextButtonVisible",false)}else{t.getOwnerComponent().getModel("glAccountModel").setProperty("/nextButtonVisible",true)}var a=o.pageSize;var l=o.totalRecords;if(a*100>=l){t.getOwnerComponent().getModel("glAccountModel").setProperty("/nextButtonVisible",false);t.getOwnerComponent().getModel("glAccountModel").setProperty("/previousButtonVisible",true)}var s=t.getOwnerComponent().getModel("glAccountModel").getData().end;if(s>l){t.getOwnerComponent().getModel("glAccountModel").setProperty("/end",l)}t.getOwnerComponent().getModel("glAccountModel").setProperty("/filtersApplied","");this.onSearch()}.bind(this),function(e){}.bind(this))},onPressExport:function(){debugger;var e=new sap.ui.model.json.JSONModel;this.getView().setModel(e,"oExportModel");var t=this.getView().byId("glTableId");var o=this.getOwnerComponent().getModel("glAccountModel").getData().indicesValues;var n=[];if(o.length===0){e.setData({results:this.getOwnerComponent().getModel("glAccountModel").getData().data.glAccountsDtoList})}else{e.setData({results:o})}e.refresh(true);var l=[];l=[{label:"I/S or BS",property:"balanceSheetAccount",type:"string"},{label:"Account Classification",property:"glAccountGroup",type:"string"},{label:"Account Rollup",property:"tdID0001",type:"string"},{label:"GL Account",property:"accountNumber",type:"string"},{label:"Account Name",property:"accountDesc",type:"string"},{label:"Account Description",property:"tdID0002",type:"string"}];var i=new Date;var a=new Date(i).getUTCHours();var s=new Date(i).getUTCMinutes();var c=new Date(i).getUTCSeconds();var g="GL_Account_Wiki_Report"+a+":"+s+":"+c;var u={workbook:{columns:l},dataSource:e.getData().results,worker:false,fileName:g,showProgress:false};new r(u).build()},onSelectionChangeIS:function(e){var t=e.getSource().getSelectedItem().getText();if(t==="All"){this.getOwnerComponent().getModel("glAccountModel").setProperty("/isorbsValue","")}else{this.getOwnerComponent().getModel("glAccountModel").setProperty("/isorbsValue",t)}var t=this.getOwnerComponent().getModel("glAccountModel").getData().isorbsValue;var o=this.getView().byId("glTableId"),n=[],l,r;r=new i({filters:[new i("balanceSheetAccount",a.Contains,e.getSource().getValue())],and:false});l=o.getBinding("items");n.push(r);l.filter(n)},onSelectionChangeAcc_Class:function(e){var t=e.getSource().getSelectedItem().getText();if(t==="All"){this.getOwnerComponent().getModel("glAccountModel").setProperty("/AccClass","")}else{this.getOwnerComponent().getModel("glAccountModel").setProperty("/AccClass",t)}var o=this.getOwnerComponent().getModel("glAccountModel").getData().AccClass;this.tableData()},onSelectionState:function(e){var t=e.getSource().getSelectedItem().getText();this.getOwnerComponent().getModel("glAccountModel").setProperty("/pageCount","1");this.getOwnerComponent().getModel("glAccountModel").setProperty("/statusActive",t);this.onSearch()},onSearch:function(e){debugger;var t=this.getView().getModel("glAccountModel").getData().balanceType;var o=this.getView().getModel("glAccountModel").getData().accountGroup;var n=this.getView().getModel("glAccountModel").getProperty("/AccRoll");var l=this.getView().getModel("glAccountModel").getProperty("/gl");var r=this.getView().getModel("glAccountModel").getProperty("/AccName");var i=this.getView().getModel("glAccountModel").getProperty("/AccDesc");var a=this.getView().getModel("glAccountModel").getData().statusActive;var s=this.getView().byId("glTableId");var c=["balanceSheetAccount","glAccountGroup","tdID0001","accountNumber","accountDesc","tdID0002","blockPostingIndicator"];var g;var u=[];if(n){this.getOwnerComponent().getModel("glAccountModel").setProperty("/indicesValues",[]);u.push(new sap.ui.model.Filter(c[2],sap.ui.model.FilterOperator.Contains,n))}if(l){this.getOwnerComponent().getModel("glAccountModel").setProperty("/indicesValues",[]);u.push(new sap.ui.model.Filter(c[3],sap.ui.model.FilterOperator.Contains,l))}if(r){this.getOwnerComponent().getModel("glAccountModel").setProperty("/indicesValues",[]);u.push(new sap.ui.model.Filter(c[4],sap.ui.model.FilterOperator.Contains,r))}if(i){this.getOwnerComponent().getModel("glAccountModel").setProperty("/indicesValues",[]);u.push(new sap.ui.model.Filter(c[5],sap.ui.model.FilterOperator.Contains,i))}if(t&&t!=="All"){this.getOwnerComponent().getModel("glAccountModel").setProperty("/indicesValues",[]);u.push(new sap.ui.model.Filter(c[0],sap.ui.model.FilterOperator.Contains,t))}if(o&&o!=="All"){this.getOwnerComponent().getModel("glAccountModel").setProperty("/indicesValues",[]);u.push(new sap.ui.model.Filter(c[1],sap.ui.model.FilterOperator.Contains,o))}if(a&&a!=="All"){this.getOwnerComponent().getModel("glAccountModel").setProperty("/indicesValues",[]);u.push(new sap.ui.model.Filter(c[6],sap.ui.model.FilterOperator.EQ,a))}g=new sap.ui.model.Filter({filters:u,and:true});s.getBinding("items").filter(g);var d=this.getView().byId("glTableId").getBinding("items").filter(g);var p=d.aIndices;debugger;if(d.aIndices.length!==0){for(var M=0;M<=p.length;M++){var A=p[M];this.getOwnerComponent().getModel("glAccountModel").getData().indicesValues.push(this.getOwnerComponent().getModel("glAccountModel").getData().data.glAccountsDtoList[A])}}},onPressAccRollUp:function(e){var t=e.getParameters().value;this.getOwnerComponent().getModel("glAccountModel").setProperty("/uRollUp",t);debugger;var o=this.getView().byId("glTableId");var n;var l=[];if(t){l.push(new sap.ui.model.Filter("AccRoll",sap.ui.model.FilterOperator.Contains,t))}n=new sap.ui.model.Filter({filters:l,and:true});o.getBinding("items").filter(n)},onPressGlAccount:function(e){var t=e.getParameters().value;this.getOwnerComponent().getModel("glAccountModel").setProperty("/uGlAccount",t);debugger;var o=this.getView().byId("glTableId");var n;var l=[];if(t){l.push(new sap.ui.model.Filter("gl",sap.ui.model.FilterOperator.Contains,t))}n=new sap.ui.model.Filter({filters:l,and:true});o.getBinding("items").filter(n)},onPressAccName:function(e){var t=e.getParameters().value;this.getOwnerComponent().getModel("glAccountModel").setProperty("/uAccName",t);var o=this.getView().byId("glTableId");var n;var l=[];if(t){l.push(new sap.ui.model.Filter("AccName",sap.ui.model.FilterOperator.Contains,t))}n=new sap.ui.model.Filter({filters:l,and:true});o.getBinding("items").filter(n)},onPressAccDesc:function(e){var t=e.getParameters().value;this.getOwnerComponent().getModel("glAccountModel").setProperty("/uAccDesc",t);var o=this.getView().byId("glTableId");var n;var l=[];if(t){l.push(new sap.ui.model.Filter("AccDesc",sap.ui.model.FilterOperator.Contains,t))}n=new sap.ui.model.Filter({filters:l,and:true});o.getBinding("items").filter(n)},onPressClear:function(){this.getOwnerComponent().getModel("glAccountModel").setProperty("/balanceType","");this.getOwnerComponent().getModel("glAccountModel").setProperty("/accountGroup","");this.getOwnerComponent().getModel("glAccountModel").setProperty("/AccRoll","");this.getOwnerComponent().getModel("glAccountModel").setProperty("/gl","");this.getOwnerComponent().getModel("glAccountModel").setProperty("/AccName","");this.getOwnerComponent().getModel("glAccountModel").setProperty("/AccDesc","");this.getOwnerComponent().getModel("glAccountModel").setProperty("/filtersApplied","");this.getOwnerComponent().getModel("glAccountModel").setProperty("/uRollUp","");this.getOwnerComponent().getModel("glAccountModel").setProperty("/uGlAccount","");this.getOwnerComponent().getModel("glAccountModel").setProperty("/uAccName","");this.getOwnerComponent().getModel("glAccountModel").setProperty("/uAccDesc","");this.tableData()}})});